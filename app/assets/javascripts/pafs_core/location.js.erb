var benefitAreaDetails, locationDetails;


locationDetails = function() {
  var locationInput = $('#location_step_project_location');
  var zoomLevelInput = $('#location_step_project_location_zoom_level');
  var location = markerLayer.getSource().getFeatures()[0].getGeometry().getCoordinates();
  var markerPoint = [Math.round(location[0]), Math.round(location[1])];
  var zoomLevel = osMap.getView().getZoom();

  locationInput.val(JSON.stringify(markerPoint));
  zoomLevelInput.val(zoomLevel);
}

benefitAreaDetails = function() {
  var areaInput = $('#map_step_benefit_area');
  var locationInput = $('#map_step_benefit_area_centre');
  var zoomLevelInput = $('#map_step_benefit_area_zoom_level');
  var zoomLevel = osMap.getView().getZoom();
  var areas = [];
  var polygons = polygonLayer.getSource().getFeatures();

  polygons.forEach(function(polygon) {
    areas.push(polygon.getGeometry().getCoordinates()[0]);
  });

  zoomLevelInput.val(JSON.stringify(zoomLevel));

  var centrePoint = osMap.getView().getCenter();
  centrePoint = [Math.round(centrePoint[0]), Math.round(centrePoint[1])]
  locationInput.val(JSON.stringify(centrePoint));

  areaInput.val(JSON.stringify(areas));
}

function addBenefitAreaDetails() {
  $('.edit_map_step').submit(benefitAreaDetails);
}

function addLocationDetails() {
  $('.edit_location_step').submit(locationDetails);
}

$(document).ready(addLocationDetails);
$(document).on('page:load', addLocationDetails);
$(document).ready(addBenefitAreaDetails);
$(document).on('page:load', addBenefitAreaDetails);
